(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function o(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=o(i);fetch(i.href,r)}})();const d=100,k=1e3,t={mode:"local",role:"host",turn:"p1_attack",p1Health:d,p2Health:d,p1Dice:0,p2Dice:0,gameOver:!1,peer:null,conn:null},y={menu:document.getElementById("menu-screen"),game:document.getElementById("game-screen")},n={btnLocal:document.getElementById("btn-local"),btnOnline:document.getElementById("btn-online"),inviteArea:document.getElementById("invite-area"),inviteLink:document.getElementById("invite-link"),btnCopy:document.getElementById("btn-copy"),p1HealthBar:document.getElementById("p1-health"),p2HealthBar:document.getElementById("p2-health"),p1HealthText:document.getElementById("p1-hp-text"),p2HealthText:document.getElementById("p2-hp-text"),p1Card:document.getElementById("p1-card"),p2Card:document.getElementById("p2-card"),p1AttackOverlay:document.getElementById("p1-attack-overlay"),p2AttackOverlay:document.getElementById("p2-attack-overlay"),turnIndicator:document.getElementById("turn-indicator"),diceValue:document.getElementById("dice-value"),btnRoll:document.getElementById("btn-roll"),log:document.getElementById("game-log"),log:document.getElementById("game-log")},P="assets/character1_basicattack.png",D="assets/character2_basicattack.png",H="assets/block.png";function B(e,a,o,s){e&&(e.src=a,e.classList.remove("show","show-block"),e.offsetWidth,e.classList.add(o),setTimeout(()=>{e.classList.remove(o)},s))}function h(e,a){const o=document.getElementById(e);if(!o)return;const s=document.createElement("div");s.classList.add("damage-number"),s.textContent=a,(a===0||a==="0")&&s.classList.add("blocked"),o.appendChild(s),setTimeout(()=>{s.remove()},2e3)}function v(e){const a=e==="p1"?n.p2AttackOverlay:n.p1AttackOverlay;a&&B(a,e==="p1"?P:D,"show",700)}function L(e){const a=e==="p1"?n.p1AttackOverlay:n.p2AttackOverlay;B(a,H,"show-block",560)}const c=new(window.AudioContext||window.webkitAudioContext);let T=!1;function R(){T||(T=!0,c.state==="suspended"&&c.resume().catch(()=>{}))}function O(){const e=c.currentTime,a=c.createOscillator(),o=c.createGain();a.connect(o),o.connect(c.destination),a.type="triangle",a.frequency.setValueAtTime(100,e),a.frequency.exponentialRampToValueAtTime(20,e+.15),o.gain.setValueAtTime(1,e),o.gain.exponentialRampToValueAtTime(.01,e+.3),a.start(e),a.stop(e+.3);const s=c.sampleRate*.5,i=c.createBuffer(1,s,c.sampleRate),r=i.getChannelData(0);for(let C=0;C<s;C++)r[C]=Math.random()*2-1;const l=c.createBufferSource();l.buffer=i;const u=c.createBiquadFilter();u.type="lowpass",u.frequency.setValueAtTime(1e3,e),u.frequency.exponentialRampToValueAtTime(100,e+.2);const f=c.createGain();l.connect(u),u.connect(f),f.connect(c.destination),f.gain.setValueAtTime(.8,e),f.gain.exponentialRampToValueAtTime(.01,e+.2),l.start(e),l.stop(e+.2)}async function S(){if(c.state==="suspended")try{await c.resume()}catch{}try{O()}catch{}}function $(){n.btnLocal.addEventListener("click",()=>I("local")),n.btnOnline.addEventListener("click",()=>M()),n.btnRoll.addEventListener("click",K),n.btnCopy.addEventListener("click",q);const a=new URLSearchParams(window.location.search).get("gameid");a&&G(a)}function I(e){t.mode=e,y.menu.classList.remove("active"),y.game.classList.add("active"),m()}function M(){t.mode="online",t.role="host",n.inviteArea.classList.remove("hidden"),t.peer=new Peer,t.peer.on("open",e=>{const a=`${window.location.href}?gameid=${e}`;n.inviteLink.textContent=a}),t.peer.on("connection",e=>{t.conn=e,_(),I("online")})}function G(e){t.mode="online",t.role="guest",y.menu.classList.remove("active"),y.game.classList.add("active"),t.peer=new Peer,t.peer.on("open",()=>{t.conn=t.peer.connect(e),_()})}function _(){t.conn.on("data",e=>{F(e)}),t.conn.on("open",()=>{console.log("Connected!"),p("Player 2 Connected!")})}function V(e){t.mode==="online"&&t.conn&&t.conn.send(e)}function F(e){e.type==="roll"?w(e.value):e.type==="restart"&&window.location.reload()}function q(){const e=n.inviteLink.textContent;!e||e==="Generating..."||navigator.clipboard.writeText(e).then(()=>{const a=n.btnCopy.textContent;n.btnCopy.textContent="Copied!",setTimeout(()=>{n.btnCopy.textContent=a},2e3)}).catch(a=>{console.error("Failed to copy text: ",a)})}function m(){const e=Math.max(0,t.p1Health/d*100),a=Math.max(0,t.p2Health/d*100);n.p1HealthBar.style.width=`${e}%`,n.p2HealthBar.style.width=`${a}%`,e<30&&n.p1HealthBar.classList.add("low"),a<30&&n.p2HealthBar.classList.add("low"),n.p1HealthText.textContent=`${t.p1Health}/${d}`,n.p2HealthText.textContent=`${t.p2Health}/${d}`,n.p1Card.classList.remove("active-turn","defending"),n.p2Card.classList.remove("active-turn","defending");let o=!1;if(t.gameOver){n.turnIndicator.textContent=t.p1Health<=0?"Player 2 Wins!":"Player 1 Wins!",n.btnRoll.disabled=!0,n.btnRoll.textContent="Game Over";return}switch(t.turn){case"p1_attack":n.turnIndicator.textContent="Player 1 Attack Phase",n.p1Card.classList.add("active-turn"),n.p2Card.classList.add("defending"),(t.mode==="local"||t.role==="host")&&(o=!0);break;case"p2_defend":n.turnIndicator.textContent="Player 2 Defend Phase",n.p2Card.classList.add("active-turn"),(t.mode==="local"||t.role==="guest")&&(o=!0);break;case"p2_attack":n.turnIndicator.textContent="Player 2 Attack Phase",n.p2Card.classList.add("active-turn"),n.p1Card.classList.add("defending"),(t.mode==="local"||t.role==="guest")&&(o=!0);break;case"p1_defend":n.turnIndicator.textContent="Player 1 Defend Phase",n.p1Card.classList.add("active-turn"),(t.mode==="local"||t.role==="host")&&(o=!0);break}n.btnRoll.disabled=!o,!o&&t.mode==="online"?n.btnRoll.textContent="Waiting for Opponent...":n.btnRoll.textContent="Roll Dice (1-10)",t.mode==="local"&&(n.btnRoll.textContent="Roll Dice")}function K(){R();const e=Math.floor(Math.random()*10)+1;V({type:"roll",value:e}),w(e)}function w(e,a){n.diceValue.textContent=e,p(`${N()} rolled ${e}!`),t.turn==="p1_attack"?(t.p1Dice=e,setTimeout(()=>b(),1e3)):t.turn==="p2_defend"?(t.p2Dice=e,setTimeout(()=>{x("p1")},1e3)):t.turn==="p2_attack"?(t.p2Dice=e,setTimeout(()=>b(),1e3)):t.turn==="p1_defend"&&(t.p1Dice=e,setTimeout(()=>{x("p2")},1e3))}function N(){return t.turn.startsWith("p1")?"Player 1":"Player 2"}function b(){t.turn==="p1_attack"?t.turn="p2_defend":t.turn==="p2_defend"?t.turn="p2_attack":t.turn==="p2_attack"?t.turn="p1_defend":t.turn==="p1_defend"&&(t.turn="p1_attack"),m()}function x(e){let a=0;e==="p1"?(a=Math.max(0,t.p1Dice-t.p2Dice),p(`Result: ${t.p1Dice} (ATK) vs ${t.p2Dice} (DEF). Damage: ${a}`),a>0?(A("p1"),setTimeout(()=>{E("p2",a),h("p2-card",a),g("p2_attack")},k)):(p("Blocked!"),L("p2"),h("p2-card",0),setTimeout(()=>g("p2_attack"),1e3))):(a=Math.max(0,t.p2Dice-t.p1Dice),p(`Result: ${t.p2Dice} (ATK) vs ${t.p1Dice} (DEF). Damage: ${a}`),a>0?(A("p2"),setTimeout(()=>{E("p1",a),h("p1-card",a),g("p1_attack")},k)):(p("Blocked!"),L("p1"),h("p1-card",0),setTimeout(()=>g("p1_attack"),1e3)))}function A(e){S(),e==="p1"?(n.p1Card.classList.add("smash-animation-p1"),setTimeout(()=>{n.p2Card.classList.add("shake-animation"),v("p1")},400),setTimeout(()=>{n.p1Card.classList.remove("smash-animation-p1"),n.p2Card.classList.remove("shake-animation")},1e3)):(n.p2Card.classList.add("smash-animation-p2"),setTimeout(()=>{n.p1Card.classList.add("shake-animation"),v("p2")},400),setTimeout(()=>{n.p2Card.classList.remove("smash-animation-p2"),n.p1Card.classList.remove("shake-animation")},1e3))}function E(e,a){e==="p1"?(t.p1Health=Math.max(0,t.p1Health-a),n.p1Card.classList.add("shake-animation")):(t.p2Health=Math.max(0,t.p2Health-a),n.p2Card.classList.add("shake-animation")),m(),W()}function g(e){t.gameOver||(t.turn=e,m())}function W(){(t.p1Health<=0||t.p2Health<=0)&&(t.gameOver=!0,m())}function p(e){n.log.textContent=e,console.log(e)}$();
