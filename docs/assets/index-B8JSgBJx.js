(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))i(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const y of r.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&i(y)}).observe(document,{childList:!0,subtree:!0});function o(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(c){if(c.ep)return;c.ep=!0;const r=o(c);fetch(c.href,r)}})();const D=""+new URL("character1_basicattack-CoZWrIpI.png",import.meta.url).href,H=""+new URL("character2_basicattack-IToyPp5v.png",import.meta.url).href,P=""+new URL("block-C_NXB4xr.png",import.meta.url).href,R=""+new URL("character1_normalattack-CmNmJq-b.wav",import.meta.url).href,O=""+new URL("character2_normalattack-DWMRuwgE.mp3",import.meta.url).href,S=""+new URL("block-BpfqxD2X.wav",import.meta.url).href,M=""+new URL("dice-Dd9cl2wV.wav",import.meta.url).href,$=""+new URL("Backgroundmusic-CXZTEdPK.mp3",import.meta.url).href,l=100,g=1e3,t={mode:"local",role:"host",turn:"p1_attack",p1Health:l,p2Health:l,p1Dice:0,p2Dice:0,gameOver:!1,peer:null,conn:null},f={menu:document.getElementById("menu-screen"),game:document.getElementById("game-screen")},a={btnLocal:document.getElementById("btn-local"),btnOnline:document.getElementById("btn-online"),inviteArea:document.getElementById("invite-area"),inviteLink:document.getElementById("invite-link"),btnCopy:document.getElementById("btn-copy"),p1HealthBar:document.getElementById("p1-health"),p2HealthBar:document.getElementById("p2-health"),p1HealthText:document.getElementById("p1-hp-text"),p2HealthText:document.getElementById("p2-hp-text"),p1Card:document.getElementById("p1-card"),p2Card:document.getElementById("p2-card"),p1AttackOverlay:document.getElementById("p1-attack-overlay"),p2AttackOverlay:document.getElementById("p2-attack-overlay"),turnIndicator:document.getElementById("turn-indicator"),diceValue:document.getElementById("dice-value"),btnRoll:document.getElementById("btn-roll"),log:document.getElementById("game-log"),log:document.getElementById("game-log")},U=D,W=H,F=P;let d=null;function G(){d||(d=new Audio($),d.loop=!0,d.volume=.2),d.play().catch(e=>console.log("BGM autoplay prevented:",e))}function E(e,n,o,i){e&&(e.src=n,e.classList.remove("show","show-block"),e.offsetWidth,e.classList.add(o),setTimeout(()=>{e.classList.remove(o)},i))}function u(e,n){const o=document.getElementById(e);if(!o)return;const i=document.createElement("div");i.classList.add("damage-number"),i.textContent=n,(n===0||n==="0")&&i.classList.add("blocked"),o.appendChild(i),setTimeout(()=>{i.remove()},2e3)}function k(e){const n=e==="p1"?a.p2AttackOverlay:a.p1AttackOverlay;n&&E(n,e==="p1"?U:W,"show",700)}function v(e){const n=e==="p1"?a.p1AttackOverlay:a.p2AttackOverlay;E(n,F,"show-block",560)}const C=new(window.AudioContext||window.webkitAudioContext);let L=!1;function h(){L||(L=!0,C.state==="suspended"&&C.resume().catch(()=>{}))}async function K(e){h();const n=e==="p1"?R:O,o=new Audio(n);try{await o.play()}catch(i){console.error("Failed to play attack sound",i)}}async function w(){h();const e=new Audio(S);try{await e.play()}catch(n){console.error("Failed to play block sound",n)}}async function N(){h();const e=new Audio(M);try{await e.play()}catch(n){console.error("Failed to play dice sound",n)}}function V(){a.btnLocal.addEventListener("click",()=>T("local")),a.btnOnline.addEventListener("click",()=>X()),a.btnRoll.addEventListener("click",Y),a.btnCopy.addEventListener("click",J);const n=new URLSearchParams(window.location.search).get("gameid");n&&q(n)}function T(e){t.mode=e,f.menu.classList.remove("active"),f.game.classList.add("active"),G(),p()}function X(){t.mode="online",t.role="host",a.inviteArea.classList.remove("hidden"),t.peer=new Peer,t.peer.on("open",e=>{const n=`${window.location.href}?gameid=${e}`;a.inviteLink.textContent=n}),t.peer.on("connection",e=>{t.conn=e,_(),T("online")})}function q(e){t.mode="online",t.role="guest",f.menu.classList.remove("active"),f.game.classList.add("active"),t.peer=new Peer,t.peer.on("open",()=>{t.conn=t.peer.connect(e),_()})}function _(){t.conn.on("data",e=>{j(e)}),t.conn.on("open",()=>{console.log("Connected!"),s("Player 2 Connected!")})}function Z(e){t.mode==="online"&&t.conn&&t.conn.send(e)}function j(e){e.type==="roll"?A(e.value):e.type==="restart"&&window.location.reload()}function J(){const e=a.inviteLink.textContent;!e||e==="Generating..."||navigator.clipboard.writeText(e).then(()=>{const n=a.btnCopy.textContent;a.btnCopy.textContent="Copied!",setTimeout(()=>{a.btnCopy.textContent=n},2e3)}).catch(n=>{console.error("Failed to copy text: ",n)})}function p(){const e=Math.max(0,t.p1Health/l*100),n=Math.max(0,t.p2Health/l*100);a.p1HealthBar.style.width=`${e}%`,a.p2HealthBar.style.width=`${n}%`,e<30&&a.p1HealthBar.classList.add("low"),n<30&&a.p2HealthBar.classList.add("low"),a.p1HealthText.textContent=`${t.p1Health}/${l}`,a.p2HealthText.textContent=`${t.p2Health}/${l}`,a.p1Card.classList.remove("active-turn","defending"),a.p2Card.classList.remove("active-turn","defending");let o=!1;if(t.gameOver){a.turnIndicator.textContent=t.p1Health<=0?"P2 Wins!":"P1 Wins!",a.btnRoll.disabled=!0;return}switch(t.turn){case"p1_attack":a.turnIndicator.textContent="P1 Attack",a.p1Card.classList.add("active-turn"),a.p2Card.classList.add("defending"),(t.mode==="local"||t.role==="host")&&(o=!0);break;case"p2_defend":a.turnIndicator.textContent="P2 Defend",a.p2Card.classList.add("active-turn"),(t.mode==="local"||t.role==="guest")&&(o=!0);break;case"p2_attack":a.turnIndicator.textContent="P2 Attack",a.p2Card.classList.add("active-turn"),a.p1Card.classList.add("defending"),(t.mode==="local"||t.role==="guest")&&(o=!0);break;case"p1_defend":a.turnIndicator.textContent="P1 Defend",a.p1Card.classList.add("active-turn"),(t.mode==="local"||t.role==="host")&&(o=!0);break}a.btnRoll.disabled=!o,a.btnRoll.style.opacity=o?"1":"0.5",a.btnRoll.style.cursor=o?"pointer":"not-allowed"}function Y(){h(),N(),a.btnRoll.disabled=!0;const e=1100,n=50,o=Date.now(),i=setInterval(()=>{const c=Math.floor(Math.random()*10)+1;if(a.diceValue.textContent=c,Date.now()-o>=e){clearInterval(i);const r=Math.floor(Math.random()*10)+1;Z({type:"roll",value:r}),A(r)}},n)}function A(e,n){a.diceValue.textContent=e,s(`${z()} rolled ${e}!`),t.turn==="p1_attack"?(t.p1Dice=e,setTimeout(()=>b(),1e3)):t.turn==="p2_defend"?(t.p2Dice=e,setTimeout(()=>{I("p1")},1e3)):t.turn==="p2_attack"?(t.p2Dice=e,setTimeout(()=>b(),1e3)):t.turn==="p1_defend"&&(t.p1Dice=e,setTimeout(()=>{I("p2")},1e3))}function z(){return t.turn.startsWith("p1")?"Player 1":"Player 2"}function b(){t.turn==="p1_attack"?t.turn="p2_defend":t.turn==="p2_defend"?t.turn="p2_attack":t.turn==="p2_attack"?t.turn="p1_defend":t.turn==="p1_defend"&&(t.turn="p1_attack"),p()}function I(e){let n=0;e==="p1"?(n=Math.max(0,t.p1Dice-t.p2Dice),s(`Result: ${t.p1Dice} (ATK) vs ${t.p2Dice} (DEF). Damage: ${n}`),n>0?(x("p1"),setTimeout(()=>{B("p2",n),u("p2-card",n),m("p2_attack")},g)):(s("Blocked!"),w(),v("p2"),u("p2-card",0),setTimeout(()=>m("p2_attack"),1e3))):(n=Math.max(0,t.p2Dice-t.p1Dice),s(`Result: ${t.p2Dice} (ATK) vs ${t.p1Dice} (DEF). Damage: ${n}`),n>0?(x("p2"),setTimeout(()=>{B("p1",n),u("p1-card",n),m("p1_attack")},g)):(s("Blocked!"),w(),v("p1"),u("p1-card",0),setTimeout(()=>m("p1_attack"),1e3)))}function x(e){K(e),e==="p1"?(a.p1Card.classList.add("smash-animation-p1"),setTimeout(()=>{a.p2Card.classList.add("shake-animation"),k("p1")},400),setTimeout(()=>{a.p1Card.classList.remove("smash-animation-p1"),a.p2Card.classList.remove("shake-animation")},1e3)):(a.p2Card.classList.add("smash-animation-p2"),setTimeout(()=>{a.p1Card.classList.add("shake-animation"),k("p2")},400),setTimeout(()=>{a.p2Card.classList.remove("smash-animation-p2"),a.p1Card.classList.remove("shake-animation")},1e3))}function B(e,n){e==="p1"?t.p1Health=Math.max(0,t.p1Health-n):t.p2Health=Math.max(0,t.p2Health-n),p(),Q()}function m(e){t.gameOver||(t.turn=e,p())}function Q(){(t.p1Health<=0||t.p2Health<=0)&&(t.gameOver=!0,p())}function s(e){a.log.textContent=e,console.log(e)}V();
