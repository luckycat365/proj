(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))i(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function o(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(c){if(c.ep)return;c.ep=!0;const r=o(c);fetch(c.href,r)}})();const D=""+new URL("character1_basicattack-CoZWrIpI.png",import.meta.url).href,H=""+new URL("character2_basicattack-IToyPp5v.png",import.meta.url).href,P=""+new URL("block-C_NXB4xr.png",import.meta.url).href,R=""+new URL("character1_normalattack-CmNmJq-b.wav",import.meta.url).href,O=""+new URL("character2_normalattack-DWMRuwgE.mp3",import.meta.url).href,S=""+new URL("block-BpfqxD2X.wav",import.meta.url).href,M=""+new URL("Backgroundmusic-CXZTEdPK.mp3",import.meta.url).href,l=100,y=1e3,e={mode:"local",role:"host",turn:"p1_attack",p1Health:l,p2Health:l,p1Dice:0,p2Dice:0,gameOver:!1,peer:null,conn:null},f={menu:document.getElementById("menu-screen"),game:document.getElementById("game-screen")},n={btnLocal:document.getElementById("btn-local"),btnOnline:document.getElementById("btn-online"),inviteArea:document.getElementById("invite-area"),inviteLink:document.getElementById("invite-link"),btnCopy:document.getElementById("btn-copy"),p1HealthBar:document.getElementById("p1-health"),p2HealthBar:document.getElementById("p2-health"),p1HealthText:document.getElementById("p1-hp-text"),p2HealthText:document.getElementById("p2-hp-text"),p1Card:document.getElementById("p1-card"),p2Card:document.getElementById("p2-card"),p1AttackOverlay:document.getElementById("p1-attack-overlay"),p2AttackOverlay:document.getElementById("p2-attack-overlay"),turnIndicator:document.getElementById("turn-indicator"),diceValue:document.getElementById("dice-value"),btnRoll:document.getElementById("btn-roll"),log:document.getElementById("game-log"),log:document.getElementById("game-log")},$=D,U=H,W=P;let d=null;function F(){d||(d=new Audio(M),d.loop=!0,d.volume=.5),d.play().catch(t=>console.log("BGM autoplay prevented:",t))}function _(t,a,o,i){t&&(t.src=a,t.classList.remove("show","show-block"),t.offsetWidth,t.classList.add(o),setTimeout(()=>{t.classList.remove(o)},i))}function u(t,a){const o=document.getElementById(t);if(!o)return;const i=document.createElement("div");i.classList.add("damage-number"),i.textContent=a,(a===0||a==="0")&&i.classList.add("blocked"),o.appendChild(i),setTimeout(()=>{i.remove()},2e3)}function k(t){const a=t==="p1"?n.p2AttackOverlay:n.p1AttackOverlay;a&&_(a,t==="p1"?$:U,"show",700)}function v(t){const a=t==="p1"?n.p1AttackOverlay:n.p2AttackOverlay;_(a,W,"show-block",560)}const C=new(window.AudioContext||window.webkitAudioContext);let L=!1;function g(){L||(L=!0,C.state==="suspended"&&C.resume().catch(()=>{}))}async function G(t){g();const a=t==="p1"?R:O,o=new Audio(a);try{await o.play()}catch(i){console.error("Failed to play attack sound",i)}}async function b(){g();const t=new Audio(S);try{await t.play()}catch(a){console.error("Failed to play block sound",a)}}function K(){n.btnLocal.addEventListener("click",()=>x("local")),n.btnOnline.addEventListener("click",()=>N()),n.btnRoll.addEventListener("click",j),n.btnCopy.addEventListener("click",Z);const a=new URLSearchParams(window.location.search).get("gameid");a&&X(a)}function x(t){e.mode=t,f.menu.classList.remove("active"),f.game.classList.add("active"),F(),p()}function N(){e.mode="online",e.role="host",n.inviteArea.classList.remove("hidden"),e.peer=new Peer,e.peer.on("open",t=>{const a=`${window.location.href}?gameid=${t}`;n.inviteLink.textContent=a}),e.peer.on("connection",t=>{e.conn=t,A(),x("online")})}function X(t){e.mode="online",e.role="guest",f.menu.classList.remove("active"),f.game.classList.add("active"),e.peer=new Peer,e.peer.on("open",()=>{e.conn=e.peer.connect(t),A()})}function A(){e.conn.on("data",t=>{V(t)}),e.conn.on("open",()=>{console.log("Connected!"),s("Player 2 Connected!")})}function q(t){e.mode==="online"&&e.conn&&e.conn.send(t)}function V(t){t.type==="roll"?T(t.value):t.type==="restart"&&window.location.reload()}function Z(){const t=n.inviteLink.textContent;!t||t==="Generating..."||navigator.clipboard.writeText(t).then(()=>{const a=n.btnCopy.textContent;n.btnCopy.textContent="Copied!",setTimeout(()=>{n.btnCopy.textContent=a},2e3)}).catch(a=>{console.error("Failed to copy text: ",a)})}function p(){const t=Math.max(0,e.p1Health/l*100),a=Math.max(0,e.p2Health/l*100);n.p1HealthBar.style.width=`${t}%`,n.p2HealthBar.style.width=`${a}%`,t<30&&n.p1HealthBar.classList.add("low"),a<30&&n.p2HealthBar.classList.add("low"),n.p1HealthText.textContent=`${e.p1Health}/${l}`,n.p2HealthText.textContent=`${e.p2Health}/${l}`,n.p1Card.classList.remove("active-turn","defending"),n.p2Card.classList.remove("active-turn","defending");let o=!1;if(e.gameOver){n.turnIndicator.textContent=e.p1Health<=0?"P2 Wins!":"P1 Wins!",n.btnRoll.disabled=!0;return}switch(e.turn){case"p1_attack":n.turnIndicator.textContent="P1 Attack",n.p1Card.classList.add("active-turn"),n.p2Card.classList.add("defending"),(e.mode==="local"||e.role==="host")&&(o=!0);break;case"p2_defend":n.turnIndicator.textContent="P2 Defend",n.p2Card.classList.add("active-turn"),(e.mode==="local"||e.role==="guest")&&(o=!0);break;case"p2_attack":n.turnIndicator.textContent="P2 Attack",n.p2Card.classList.add("active-turn"),n.p1Card.classList.add("defending"),(e.mode==="local"||e.role==="guest")&&(o=!0);break;case"p1_defend":n.turnIndicator.textContent="P1 Defend",n.p1Card.classList.add("active-turn"),(e.mode==="local"||e.role==="host")&&(o=!0);break}n.btnRoll.disabled=!o,n.btnRoll.style.opacity=o?"1":"0.5",n.btnRoll.style.cursor=o?"pointer":"not-allowed"}function j(){g();const t=Math.floor(Math.random()*10)+1;q({type:"roll",value:t}),T(t)}function T(t,a){n.diceValue.textContent=t,s(`${J()} rolled ${t}!`),e.turn==="p1_attack"?(e.p1Dice=t,setTimeout(()=>w(),1e3)):e.turn==="p2_defend"?(e.p2Dice=t,setTimeout(()=>{B("p1")},1e3)):e.turn==="p2_attack"?(e.p2Dice=t,setTimeout(()=>w(),1e3)):e.turn==="p1_defend"&&(e.p1Dice=t,setTimeout(()=>{B("p2")},1e3))}function J(){return e.turn.startsWith("p1")?"Player 1":"Player 2"}function w(){e.turn==="p1_attack"?e.turn="p2_defend":e.turn==="p2_defend"?e.turn="p2_attack":e.turn==="p2_attack"?e.turn="p1_defend":e.turn==="p1_defend"&&(e.turn="p1_attack"),p()}function B(t){let a=0;t==="p1"?(a=Math.max(0,e.p1Dice-e.p2Dice),s(`Result: ${e.p1Dice} (ATK) vs ${e.p2Dice} (DEF). Damage: ${a}`),a>0?(E("p1"),setTimeout(()=>{I("p2",a),u("p2-card",a),m("p2_attack")},y)):(s("Blocked!"),b(),v("p2"),u("p2-card",0),setTimeout(()=>m("p2_attack"),1e3))):(a=Math.max(0,e.p2Dice-e.p1Dice),s(`Result: ${e.p2Dice} (ATK) vs ${e.p1Dice} (DEF). Damage: ${a}`),a>0?(E("p2"),setTimeout(()=>{I("p1",a),u("p1-card",a),m("p1_attack")},y)):(s("Blocked!"),b(),v("p1"),u("p1-card",0),setTimeout(()=>m("p1_attack"),1e3)))}function E(t){G(t),t==="p1"?(n.p1Card.classList.add("smash-animation-p1"),setTimeout(()=>{n.p2Card.classList.add("shake-animation"),k("p1")},400),setTimeout(()=>{n.p1Card.classList.remove("smash-animation-p1"),n.p2Card.classList.remove("shake-animation")},1e3)):(n.p2Card.classList.add("smash-animation-p2"),setTimeout(()=>{n.p1Card.classList.add("shake-animation"),k("p2")},400),setTimeout(()=>{n.p2Card.classList.remove("smash-animation-p2"),n.p1Card.classList.remove("shake-animation")},1e3))}function I(t,a){t==="p1"?e.p1Health=Math.max(0,e.p1Health-a):e.p2Health=Math.max(0,e.p2Health-a),p(),Y()}function m(t){e.gameOver||(e.turn=t,p())}function Y(){(e.p1Health<=0||e.p2Health<=0)&&(e.gameOver=!0,p())}function s(t){n.log.textContent=t,console.log(t)}K();
