(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=o(i);fetch(i.href,s)}})();const P=""+new URL("character1_basicattack-CoZWrIpI.png",import.meta.url).href,R=""+new URL("character2_basicattack-IToyPp5v.png",import.meta.url).href,D=""+new URL("block-C_NXB4xr.png",import.meta.url).href,d=100,k=1e3,t={mode:"local",role:"host",turn:"p1_attack",p1Health:d,p2Health:d,p1Dice:0,p2Dice:0,gameOver:!1,peer:null,conn:null},y={menu:document.getElementById("menu-screen"),game:document.getElementById("game-screen")},n={btnLocal:document.getElementById("btn-local"),btnOnline:document.getElementById("btn-online"),inviteArea:document.getElementById("invite-area"),inviteLink:document.getElementById("invite-link"),btnCopy:document.getElementById("btn-copy"),p1HealthBar:document.getElementById("p1-health"),p2HealthBar:document.getElementById("p2-health"),p1HealthText:document.getElementById("p1-hp-text"),p2HealthText:document.getElementById("p2-hp-text"),p1Card:document.getElementById("p1-card"),p2Card:document.getElementById("p2-card"),p1AttackOverlay:document.getElementById("p1-attack-overlay"),p2AttackOverlay:document.getElementById("p2-attack-overlay"),turnIndicator:document.getElementById("turn-indicator"),diceValue:document.getElementById("dice-value"),btnRoll:document.getElementById("btn-roll"),log:document.getElementById("game-log"),log:document.getElementById("game-log")},H=P,O=R,S=D;function w(e,a,o,r){e&&(e.src=a,e.classList.remove("show","show-block"),e.offsetWidth,e.classList.add(o),setTimeout(()=>{e.classList.remove(o)},r))}function h(e,a){const o=document.getElementById(e);if(!o)return;const r=document.createElement("div");r.classList.add("damage-number"),r.textContent=a,(a===0||a==="0")&&r.classList.add("blocked"),o.appendChild(r),setTimeout(()=>{r.remove()},2e3)}function v(e){const a=e==="p1"?n.p2AttackOverlay:n.p1AttackOverlay;a&&w(a,e==="p1"?H:O,"show",700)}function L(e){const a=e==="p1"?n.p1AttackOverlay:n.p2AttackOverlay;w(a,S,"show-block",560)}const c=new(window.AudioContext||window.webkitAudioContext);let T=!1;function $(){T||(T=!0,c.state==="suspended"&&c.resume().catch(()=>{}))}function M(){const e=c.currentTime,a=c.createOscillator(),o=c.createGain();a.connect(o),o.connect(c.destination),a.type="triangle",a.frequency.setValueAtTime(100,e),a.frequency.exponentialRampToValueAtTime(20,e+.15),o.gain.setValueAtTime(1,e),o.gain.exponentialRampToValueAtTime(.01,e+.3),a.start(e),a.stop(e+.3);const r=c.sampleRate*.5,i=c.createBuffer(1,r,c.sampleRate),s=i.getChannelData(0);for(let C=0;C<r;C++)s[C]=Math.random()*2-1;const l=c.createBufferSource();l.buffer=i;const u=c.createBiquadFilter();u.type="lowpass",u.frequency.setValueAtTime(1e3,e),u.frequency.exponentialRampToValueAtTime(100,e+.2);const f=c.createGain();l.connect(u),u.connect(f),f.connect(c.destination),f.gain.setValueAtTime(.8,e),f.gain.exponentialRampToValueAtTime(.01,e+.2),l.start(e),l.stop(e+.2)}async function G(){if(c.state==="suspended")try{await c.resume()}catch{}try{M()}catch{}}function V(){n.btnLocal.addEventListener("click",()=>B("local")),n.btnOnline.addEventListener("click",()=>F()),n.btnRoll.addEventListener("click",W),n.btnCopy.addEventListener("click",U);const a=new URLSearchParams(window.location.search).get("gameid");a&&q(a)}function B(e){t.mode=e,y.menu.classList.remove("active"),y.game.classList.add("active"),m()}function F(){t.mode="online",t.role="host",n.inviteArea.classList.remove("hidden"),t.peer=new Peer,t.peer.on("open",e=>{const a=`${window.location.href}?gameid=${e}`;n.inviteLink.textContent=a}),t.peer.on("connection",e=>{t.conn=e,E(),B("online")})}function q(e){t.mode="online",t.role="guest",y.menu.classList.remove("active"),y.game.classList.add("active"),t.peer=new Peer,t.peer.on("open",()=>{t.conn=t.peer.connect(e),E()})}function E(){t.conn.on("data",e=>{N(e)}),t.conn.on("open",()=>{console.log("Connected!"),p("Player 2 Connected!")})}function K(e){t.mode==="online"&&t.conn&&t.conn.send(e)}function N(e){e.type==="roll"?_(e.value):e.type==="restart"&&window.location.reload()}function U(){const e=n.inviteLink.textContent;!e||e==="Generating..."||navigator.clipboard.writeText(e).then(()=>{const a=n.btnCopy.textContent;n.btnCopy.textContent="Copied!",setTimeout(()=>{n.btnCopy.textContent=a},2e3)}).catch(a=>{console.error("Failed to copy text: ",a)})}function m(){const e=Math.max(0,t.p1Health/d*100),a=Math.max(0,t.p2Health/d*100);n.p1HealthBar.style.width=`${e}%`,n.p2HealthBar.style.width=`${a}%`,e<30&&n.p1HealthBar.classList.add("low"),a<30&&n.p2HealthBar.classList.add("low"),n.p1HealthText.textContent=`${t.p1Health}/${d}`,n.p2HealthText.textContent=`${t.p2Health}/${d}`,n.p1Card.classList.remove("active-turn","defending"),n.p2Card.classList.remove("active-turn","defending");let o=!1;if(t.gameOver){n.turnIndicator.textContent=t.p1Health<=0?"Player 2 Wins!":"Player 1 Wins!",n.btnRoll.disabled=!0,n.btnRoll.textContent="Game Over";return}switch(t.turn){case"p1_attack":n.turnIndicator.textContent="Player 1 Attack Phase",n.p1Card.classList.add("active-turn"),n.p2Card.classList.add("defending"),(t.mode==="local"||t.role==="host")&&(o=!0);break;case"p2_defend":n.turnIndicator.textContent="Player 2 Defend Phase",n.p2Card.classList.add("active-turn"),(t.mode==="local"||t.role==="guest")&&(o=!0);break;case"p2_attack":n.turnIndicator.textContent="Player 2 Attack Phase",n.p2Card.classList.add("active-turn"),n.p1Card.classList.add("defending"),(t.mode==="local"||t.role==="guest")&&(o=!0);break;case"p1_defend":n.turnIndicator.textContent="Player 1 Defend Phase",n.p1Card.classList.add("active-turn"),(t.mode==="local"||t.role==="host")&&(o=!0);break}n.btnRoll.disabled=!o,!o&&t.mode==="online"?n.btnRoll.textContent="Waiting for Opponent...":n.btnRoll.textContent="Roll Dice (1-10)",t.mode==="local"&&(n.btnRoll.textContent="Roll Dice")}function W(){$();const e=Math.floor(Math.random()*10)+1;K({type:"roll",value:e}),_(e)}function _(e,a){n.diceValue.textContent=e,p(`${X()} rolled ${e}!`),t.turn==="p1_attack"?(t.p1Dice=e,setTimeout(()=>b(),1e3)):t.turn==="p2_defend"?(t.p2Dice=e,setTimeout(()=>{x("p1")},1e3)):t.turn==="p2_attack"?(t.p2Dice=e,setTimeout(()=>b(),1e3)):t.turn==="p1_defend"&&(t.p1Dice=e,setTimeout(()=>{x("p2")},1e3))}function X(){return t.turn.startsWith("p1")?"Player 1":"Player 2"}function b(){t.turn==="p1_attack"?t.turn="p2_defend":t.turn==="p2_defend"?t.turn="p2_attack":t.turn==="p2_attack"?t.turn="p1_defend":t.turn==="p1_defend"&&(t.turn="p1_attack"),m()}function x(e){let a=0;e==="p1"?(a=Math.max(0,t.p1Dice-t.p2Dice),p(`Result: ${t.p1Dice} (ATK) vs ${t.p2Dice} (DEF). Damage: ${a}`),a>0?(I("p1"),setTimeout(()=>{A("p2",a),h("p2-card",a),g("p2_attack")},k)):(p("Blocked!"),L("p2"),h("p2-card",0),setTimeout(()=>g("p2_attack"),1e3))):(a=Math.max(0,t.p2Dice-t.p1Dice),p(`Result: ${t.p2Dice} (ATK) vs ${t.p1Dice} (DEF). Damage: ${a}`),a>0?(I("p2"),setTimeout(()=>{A("p1",a),h("p1-card",a),g("p1_attack")},k)):(p("Blocked!"),L("p1"),h("p1-card",0),setTimeout(()=>g("p1_attack"),1e3)))}function I(e){G(),e==="p1"?(n.p1Card.classList.add("smash-animation-p1"),setTimeout(()=>{n.p2Card.classList.add("shake-animation"),v("p1")},400),setTimeout(()=>{n.p1Card.classList.remove("smash-animation-p1"),n.p2Card.classList.remove("shake-animation")},1e3)):(n.p2Card.classList.add("smash-animation-p2"),setTimeout(()=>{n.p1Card.classList.add("shake-animation"),v("p2")},400),setTimeout(()=>{n.p2Card.classList.remove("smash-animation-p2"),n.p1Card.classList.remove("shake-animation")},1e3))}function A(e,a){e==="p1"?(t.p1Health=Math.max(0,t.p1Health-a),n.p1Card.classList.add("shake-animation")):(t.p2Health=Math.max(0,t.p2Health-a),n.p2Card.classList.add("shake-animation")),m(),j()}function g(e){t.gameOver||(t.turn=e,m())}function j(){(t.p1Health<=0||t.p2Health<=0)&&(t.gameOver=!0,m())}function p(e){n.log.textContent=e,console.log(e)}V();
