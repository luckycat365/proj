(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))f(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const p of s.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&f(p)}).observe(document,{childList:!0,subtree:!0});function o(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function f(i){if(i.ep)return;i.ep=!0;const s=o(i);fetch(i.href,s)}})();const c=100,g=1e3,e={mode:"local",role:"host",turn:"p1_attack",p1Health:c,p2Health:c,p1Dice:0,p2Dice:0,gameOver:!1,peer:null,conn:null,isMusicPlaying:!1},m={menu:document.getElementById("menu-screen"),game:document.getElementById("game-screen")},t={btnLocal:document.getElementById("btn-local"),btnOnline:document.getElementById("btn-online"),inviteArea:document.getElementById("invite-area"),inviteLink:document.getElementById("invite-link"),p1HealthBar:document.getElementById("p1-health"),p2HealthBar:document.getElementById("p2-health"),p1HealthText:document.getElementById("p1-hp-text"),p2HealthText:document.getElementById("p2-hp-text"),p1Card:document.getElementById("p1-card"),p2Card:document.getElementById("p2-card"),turnIndicator:document.getElementById("turn-indicator"),diceValue:document.getElementById("dice-value"),btnRoll:document.getElementById("btn-roll"),log:document.getElementById("game-log"),bgm:document.getElementById("bgm"),sfxSmash:document.getElementById("sfx-smash"),musicToggle:document.getElementById("btn-music-toggle")},l=new(window.AudioContext||window.webkitAudioContext);function k(){if(!t.sfxSmash.play().catch(()=>!1)){const a=l.createOscillator(),o=l.createGain();a.connect(o),o.connect(l.destination),a.type="sawtooth",a.frequency.setValueAtTime(100,l.currentTime),a.frequency.exponentialRampToValueAtTime(.01,l.currentTime+.5),o.gain.setValueAtTime(1,l.currentTime),o.gain.exponentialRampToValueAtTime(.01,l.currentTime+.5),a.start(),a.stop(l.currentTime+.5)}}function b(){t.btnLocal.addEventListener("click",()=>v("local")),t.btnOnline.addEventListener("click",()=>E()),t.btnRoll.addEventListener("click",D),t.musicToggle.addEventListener("click",w),t.bgm.volume=.5,t.musicToggle.classList.add("muted");const a=new URLSearchParams(window.location.search).get("gameid");a&&P(a)}function v(n){e.mode=n,m.menu.classList.remove("active"),m.game.classList.add("active"),d()}function E(){e.mode="online",e.role="host",t.inviteArea.classList.remove("hidden"),e.peer=new Peer,e.peer.on("open",n=>{const a=`${window.location.href}?gameid=${n}`;t.inviteLink.textContent=a}),e.peer.on("connection",n=>{e.conn=n,T(),v("online")})}function P(n){e.mode="online",e.role="guest",m.menu.classList.remove("active"),m.game.classList.add("active"),e.peer=new Peer,e.peer.on("open",()=>{e.conn=e.peer.connect(n),T()})}function T(){e.conn.on("data",n=>{B(n)}),e.conn.on("open",()=>{console.log("Connected!"),r("Player 2 Connected!")})}function I(n){e.mode==="online"&&e.conn&&e.conn.send(n)}function B(n){n.type==="roll"?x(n.value):n.type==="restart"&&window.location.reload()}function d(){const n=Math.max(0,e.p1Health/c*100),a=Math.max(0,e.p2Health/c*100);t.p1HealthBar.style.width=`${n}%`,t.p2HealthBar.style.width=`${a}%`,n<30&&t.p1HealthBar.classList.add("low"),a<30&&t.p2HealthBar.classList.add("low"),t.p1HealthText.textContent=`${e.p1Health}/${c}`,t.p2HealthText.textContent=`${e.p2Health}/${c}`,t.p1Card.classList.remove("active-turn","defending"),t.p2Card.classList.remove("active-turn","defending");let o=!1;if(e.gameOver){t.turnIndicator.textContent=e.p1Health<=0?"Player 2 Wins!":"Player 1 Wins!",t.btnRoll.disabled=!0,t.btnRoll.textContent="Game Over";return}switch(e.turn){case"p1_attack":t.turnIndicator.textContent="Player 1 Attack Phase",t.p1Card.classList.add("active-turn"),t.p2Card.classList.add("defending"),(e.mode==="local"||e.role==="host")&&(o=!0);break;case"p2_defend":t.turnIndicator.textContent="Player 2 Defend Phase",t.p2Card.classList.add("active-turn"),(e.mode==="local"||e.role==="guest")&&(o=!0);break;case"p2_attack":t.turnIndicator.textContent="Player 2 Attack Phase",t.p2Card.classList.add("active-turn"),t.p1Card.classList.add("defending"),(e.mode==="local"||e.role==="guest")&&(o=!0);break;case"p1_defend":t.turnIndicator.textContent="Player 1 Defend Phase",t.p1Card.classList.add("active-turn"),(e.mode==="local"||e.role==="host")&&(o=!0);break}t.btnRoll.disabled=!o,!o&&e.mode==="online"?t.btnRoll.textContent="Waiting for Opponent...":t.btnRoll.textContent="Roll Dice (1-10)",e.mode==="local"&&(t.btnRoll.textContent="Roll Dice")}function D(){const n=Math.floor(Math.random()*10)+1;I({type:"roll",value:n}),x(n)}function x(n,a){t.diceValue.textContent=n,r(`${H()} rolled ${n}!`),e.turn==="p1_attack"?(e.p1Dice=n,setTimeout(()=>h(),1e3)):e.turn==="p2_defend"?(e.p2Dice=n,setTimeout(()=>{y("p1")},1e3)):e.turn==="p2_attack"?(e.p2Dice=n,setTimeout(()=>h(),1e3)):e.turn==="p1_defend"&&(e.p1Dice=n,setTimeout(()=>{y("p2")},1e3))}function H(){return e.turn.startsWith("p1")?"Player 1":"Player 2"}function h(){e.turn==="p1_attack"?e.turn="p2_defend":e.turn==="p2_defend"?e.turn="p2_attack":e.turn==="p2_attack"?e.turn="p1_defend":e.turn==="p1_defend"&&(e.turn="p1_attack"),d()}function y(n){let a=0;n==="p1"?(a=Math.max(0,e.p1Dice-e.p2Dice),r(`Result: ${e.p1Dice} (ATK) vs ${e.p2Dice} (DEF). Damage: ${a}`),a>0?(L("p1"),setTimeout(()=>{C("p2",a),u("p2_attack")},g)):(r("Blocked!"),setTimeout(()=>u("p2_attack"),1e3))):(a=Math.max(0,e.p2Dice-e.p1Dice),r(`Result: ${e.p2Dice} (ATK) vs ${e.p1Dice} (DEF). Damage: ${a}`),a>0?(L("p2"),setTimeout(()=>{C("p1",a),u("p1_attack")},g)):(r("Blocked!"),setTimeout(()=>u("p1_attack"),1e3)))}function L(n){k(),n==="p1"?(t.p1Card.classList.add("smash-animation-p1"),setTimeout(()=>{t.p2Card.classList.add("shake-animation")},400),setTimeout(()=>{t.p1Card.classList.remove("smash-animation-p1"),t.p2Card.classList.remove("shake-animation")},1e3)):(t.p2Card.classList.add("smash-animation-p2"),setTimeout(()=>{t.p1Card.classList.add("shake-animation")},400),setTimeout(()=>{t.p2Card.classList.remove("smash-animation-p2"),t.p1Card.classList.remove("shake-animation")},1e3))}function C(n,a){n==="p1"?(e.p1Health=Math.max(0,e.p1Health-a),t.p1Card.classList.add("shake-animation")):(e.p2Health=Math.max(0,e.p2Health-a),t.p2Card.classList.add("shake-animation")),d(),_()}function u(n){e.gameOver||(e.turn=n,d())}function _(){(e.p1Health<=0||e.p2Health<=0)&&(e.gameOver=!0,d())}function r(n){t.log.textContent=n,console.log(n)}function w(){e.isMusicPlaying=!e.isMusicPlaying,e.isMusicPlaying?t.bgm.play().then(()=>{t.musicToggle.classList.remove("muted")}).catch(n=>{console.error("Audio play failed:",n),e.isMusicPlaying=!1}):(t.bgm.pause(),t.musicToggle.classList.add("muted"))}b();
