(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))r(c);new MutationObserver(c=>{for(const i of c)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(c){const i={};return c.integrity&&(i.integrity=c.integrity),c.referrerPolicy&&(i.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?i.credentials="include":c.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(c){if(c.ep)return;c.ep=!0;const i=o(c);fetch(c.href,i)}})();const R=""+new URL("character1_basicattack-CoZWrIpI.png",import.meta.url).href,D=""+new URL("character2_basicattack-IToyPp5v.png",import.meta.url).href,P=""+new URL("block-C_NXB4xr.png",import.meta.url).href,H=""+new URL("counterattack-BurVMCqk.png",import.meta.url).href,O=""+new URL("character1_normalattack-CmNmJq-b.wav",import.meta.url).href,S=""+new URL("character2_normalattack-DWMRuwgE.mp3",import.meta.url).href,$=""+new URL("block-BpfqxD2X.wav",import.meta.url).href,M=""+new URL("dice-Dd9cl2wV.wav",import.meta.url).href,U=""+new URL("Backgroundmusic-CXZTEdPK.mp3",import.meta.url).href,d=100,v=1e3,t={mode:"local",role:"host",turn:"p1_attack",p1Health:d,p2Health:d,p1Dice:0,p2Dice:0,gameOver:!1,peer:null,conn:null},f={menu:document.getElementById("menu-screen"),game:document.getElementById("game-screen")},n={btnLocal:document.getElementById("btn-local"),btnOnline:document.getElementById("btn-online"),inviteArea:document.getElementById("invite-area"),inviteLink:document.getElementById("invite-link"),btnCopy:document.getElementById("btn-copy"),p1HealthBar:document.getElementById("p1-health"),p2HealthBar:document.getElementById("p2-health"),p1HealthText:document.getElementById("p1-hp-text"),p2HealthText:document.getElementById("p2-hp-text"),p1Card:document.getElementById("p1-card"),p2Card:document.getElementById("p2-card"),p1AttackOverlay:document.getElementById("p1-attack-overlay"),p2AttackOverlay:document.getElementById("p2-attack-overlay"),turnIndicator:document.getElementById("turn-indicator"),diceValue:document.getElementById("dice-value"),btnRoll:document.getElementById("btn-roll"),log:document.getElementById("game-log"),log:document.getElementById("game-log")},K=R,W=D,F=P,N=H;let p=null;function G(){p||(p=new Audio(U),p.loop=!0,p.volume=.2),p.play().catch(e=>console.log("BGM autoplay prevented:",e))}function k(e,a,o,r){e&&(e.src=a,e.classList.remove("show","show-block"),e.offsetWidth,e.classList.add(o),setTimeout(()=>{e.classList.remove(o)},r))}function g(e,a){const o=document.getElementById(e);if(!o)return;const r=document.createElement("div");r.classList.add("damage-number"),r.textContent=a,(a===0||a==="0")&&r.classList.add("blocked"),o.appendChild(r),setTimeout(()=>{r.remove()},2e3)}function C(e){const a=e==="p1"?n.p2AttackOverlay:n.p1AttackOverlay;a&&k(a,e==="p1"?K:W,"show",700)}function V(e){const a=e==="p1"?n.p1AttackOverlay:n.p2AttackOverlay;k(a,F,"show-block",560)}function w(e){const a=e==="p1"?n.p1AttackOverlay:n.p2AttackOverlay;k(a,N,"show-block",800)}const L=new(window.AudioContext||window.webkitAudioContext);let b=!1;function h(){b||(b=!0,L.state==="suspended"&&L.resume().catch(()=>{}))}async function q(e){h();const a=e==="p1"?O:S,o=new Audio(a);try{await o.play()}catch(r){console.error("Failed to play attack sound",r)}}async function X(){h();const e=new Audio($);try{await e.play()}catch(a){console.error("Failed to play block sound",a)}}async function Z(){h();const e=new Audio(M);try{await e.play()}catch(a){console.error("Failed to play dice sound",a)}}function j(){n.btnLocal.addEventListener("click",()=>E("local")),n.btnOnline.addEventListener("click",()=>J()),n.btnRoll.addEventListener("click",te),n.btnCopy.addEventListener("click",ee);const a=new URLSearchParams(window.location.search).get("gameid");a&&Y(a)}function E(e){t.mode=e,f.menu.classList.remove("active"),f.game.classList.add("active"),G(),m()}function J(){t.mode="online",t.role="host",n.inviteArea.classList.remove("hidden"),t.peer=new Peer,t.peer.on("open",e=>{const a=`${window.location.href}?gameid=${e}`;n.inviteLink.textContent=a}),t.peer.on("connection",e=>{t.conn=e,B(),E("online")})}function Y(e){t.mode="online",t.role="guest",f.menu.classList.remove("active"),f.game.classList.add("active"),t.peer=new Peer,t.peer.on("open",()=>{t.conn=t.peer.connect(e),B()})}function B(){t.conn.on("data",e=>{Q(e)}),t.conn.on("open",()=>{console.log("Connected!"),u("Player 2 Connected!")})}function z(e){t.mode==="online"&&t.conn&&t.conn.send(e)}function Q(e){e.type==="roll"?x(e.value):e.type==="restart"&&window.location.reload()}function ee(){const e=n.inviteLink.textContent;!e||e==="Generating..."||navigator.clipboard.writeText(e).then(()=>{const a=n.btnCopy.textContent;n.btnCopy.textContent="Copied!",setTimeout(()=>{n.btnCopy.textContent=a},2e3)}).catch(a=>{console.error("Failed to copy text: ",a)})}function m(){const e=Math.max(0,t.p1Health/d*100),a=Math.max(0,t.p2Health/d*100);n.p1HealthBar.style.width=`${e}%`,n.p2HealthBar.style.width=`${a}%`,e<30&&n.p1HealthBar.classList.add("low"),a<30&&n.p2HealthBar.classList.add("low"),n.p1HealthText.textContent=`${t.p1Health}/${d}`,n.p2HealthText.textContent=`${t.p2Health}/${d}`,n.p1Card.classList.remove("active-turn","defending","defense-glow"),n.p2Card.classList.remove("active-turn","defending","defense-glow");let o=!1;if(t.gameOver){n.turnIndicator.textContent=t.p1Health<=0?"P2 Wins!":"P1 Wins!",n.btnRoll.disabled=!0;return}switch(t.turn){case"p1_attack":n.turnIndicator.textContent="P1 Attack",n.p1Card.classList.add("active-turn"),n.p2Card.classList.add("defending"),(t.mode==="local"||t.role==="host")&&(o=!0);break;case"p2_defend":n.turnIndicator.textContent="P2 Defend",n.p2Card.classList.add("active-turn","defense-glow"),(t.mode==="local"||t.role==="guest")&&(o=!0);break;case"p2_attack":n.turnIndicator.textContent="P2 Attack",n.p2Card.classList.add("active-turn"),n.p1Card.classList.add("defending"),(t.mode==="local"||t.role==="guest")&&(o=!0);break;case"p1_defend":n.turnIndicator.textContent="P1 Defend",n.p1Card.classList.add("active-turn","defense-glow"),(t.mode==="local"||t.role==="host")&&(o=!0);break}n.btnRoll.disabled=!o,n.btnRoll.style.opacity=o?"1":"0.5",n.btnRoll.style.cursor=o?"pointer":"not-allowed"}function te(){h(),Z(),n.btnRoll.disabled=!0;const e=1100,a=50,o=Date.now(),r=setInterval(()=>{const c=Math.floor(Math.random()*10)+1;if(n.diceValue.textContent=c,Date.now()-o>=e){clearInterval(r);const i=Math.floor(Math.random()*10)+1;z({type:"roll",value:i}),x(i)}},a)}function x(e,a){n.diceValue.textContent=e,u(`${ne()} rolled ${e}!`),t.turn==="p1_attack"?(t.p1Dice=e,setTimeout(()=>A(),1e3)):t.turn==="p2_defend"?(t.p2Dice=e,setTimeout(()=>{T("p1")},1e3)):t.turn==="p2_attack"?(t.p2Dice=e,setTimeout(()=>A(),1e3)):t.turn==="p1_defend"&&(t.p1Dice=e,setTimeout(()=>{T("p2")},1e3))}function ne(){return t.turn.startsWith("p1")?"Player 1":"Player 2"}function A(){t.turn==="p1_attack"?t.turn="p2_defend":t.turn==="p2_defend"?t.turn="p2_attack":t.turn==="p2_attack"?t.turn="p1_defend":t.turn==="p1_defend"&&(t.turn="p1_attack"),m()}function T(e){n.p1Card.classList.remove("active-turn","defending","defense-glow"),n.p2Card.classList.remove("active-turn","defending","defense-glow");const a=e==="p1",o=a?t.p1Dice:t.p2Dice,r=a?t.p2Dice:t.p1Dice,c=o-r,i=a?"p2":"p1",s=a?"p1":"p2";if(c>0){const l=c;u(`Result: ${o} (ATK) vs ${r} (DEF). Damage: ${l}`),I(s,!1),setTimeout(()=>{_(i,l),g(`${i}-card`,l),y(a?"p2_attack":"p1_attack")},v)}else if(c>=-2)u(`Result: ${o} (ATK) vs ${r} (DEF). Blocked!`),X(),V(i),g(`${i}-card`,0),setTimeout(()=>y(a?"p2_attack":"p1_attack"),1e3);else{const l=Math.abs(c);u(`Result: ${o} (ATK) vs ${r} (DEF). COUNTER ATTACK! (-${l} HP)`),I(i,!0),setTimeout(()=>{_(s,l),g(`${s}-card`,l),y(a?"p2_attack":"p1_attack")},v)}}function I(e,a=!1){q(e),e==="p1"?(n.p1Card.classList.add("smash-animation-p1"),setTimeout(()=>{n.p2Card.classList.add("shake-animation"),a?w("p2"):C("p1")},400),setTimeout(()=>{n.p1Card.classList.remove("smash-animation-p1"),n.p2Card.classList.remove("shake-animation")},1e3)):(n.p2Card.classList.add("smash-animation-p2"),setTimeout(()=>{n.p1Card.classList.add("shake-animation"),a?w("p1"):C("p2")},400),setTimeout(()=>{n.p2Card.classList.remove("smash-animation-p2"),n.p1Card.classList.remove("shake-animation")},1e3))}function _(e,a){e==="p1"?t.p1Health=Math.max(0,t.p1Health-a):t.p2Health=Math.max(0,t.p2Health-a),m(),ae()}function y(e){t.gameOver||(t.turn=e,m())}function ae(){(t.p1Health<=0||t.p2Health<=0)&&(t.gameOver=!0,m())}function u(e){n.log.textContent=e,console.log(e)}j();
