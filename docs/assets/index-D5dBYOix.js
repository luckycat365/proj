(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function i(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(o){if(o.ep)return;o.ep=!0;const r=i(o);fetch(o.href,r)}})();const N=""+new URL("character1_basicattack-CoZWrIpI.png",import.meta.url).href,U=""+new URL("character2_basicattack-IToyPp5v.png",import.meta.url).href,W=""+new URL("block-C_NXB4xr.png",import.meta.url).href,V=""+new URL("counterattack-BurVMCqk.png",import.meta.url).href,F=""+new URL("character1_normalattack-CmNmJq-b.wav",import.meta.url).href,G=""+new URL("character2_normalattack-DWMRuwgE.mp3",import.meta.url).href,K=""+new URL("block-BpfqxD2X.wav",import.meta.url).href,q=""+new URL("dice-Dd9cl2wV.wav",import.meta.url).href,X=""+new URL("Backgroundmusic-CXZTEdPK.mp3",import.meta.url).href,L=1e3,e={mode:"local",role:"host",turn:"p1_attack",p1Health:100,p2Health:100,p1Dice:0,p2Dice:0,黄凌侯:null,文亮:null,gameOver:!1,peer:null,conn:null},g={menu:document.getElementById("menu-screen"),game:document.getElementById("game-screen")},a={btnLocal:document.getElementById("btn-local"),btnOnline:document.getElementById("btn-online"),inviteArea:document.getElementById("invite-area"),inviteLink:document.getElementById("invite-link"),btnCopy:document.getElementById("btn-copy"),p1HealthBar:document.getElementById("p1-health"),p2HealthBar:document.getElementById("p2-health"),p1HealthText:document.getElementById("p1-hp-text"),p2HealthText:document.getElementById("p2-hp-text"),p1Name:document.getElementById("p1-name"),p2Name:document.getElementById("p2-name"),p1Card:document.getElementById("p1-card"),p2Card:document.getElementById("p2-card"),p1AttackOverlay:document.getElementById("p1-attack-overlay"),p2AttackOverlay:document.getElementById("p2-attack-overlay"),turnIndicator:document.getElementById("turn-indicator"),diceValue:document.getElementById("dice-value"),btnRoll:document.getElementById("btn-roll"),log:document.getElementById("game-log")},Z=N,j=U,J=W,Y=V;let m=null;function z(){m||(m=new Audio(X),m.loop=!0,m.volume=.2),m.play().catch(t=>console.log("BGM autoplay prevented:",t))}function b(t,n,i,c){t&&(t.src=n,t.classList.remove("show","show-block"),t.offsetWidth,t.classList.add(i),setTimeout(()=>{t.classList.remove(i)},c))}function v(t,n){const i=document.getElementById(t);if(!i)return;const c=document.createElement("div");c.classList.add("damage-number"),c.textContent=n,(n===0||n==="0")&&c.classList.add("blocked"),i.appendChild(c),setTimeout(()=>{c.remove()},2e3)}function I(t){const n=t==="p1"?a.p2AttackOverlay:a.p1AttackOverlay;n&&b(n,t==="p1"?Z:j,"show",700)}function Q(t){const n=t==="p1"?a.p1AttackOverlay:a.p2AttackOverlay;b(n,J,"show-block",560)}function A(t){const n=t==="p1"?a.p1AttackOverlay:a.p2AttackOverlay;b(n,Y,"show-block",800)}class _{constructor(n,i,c,o,r){this.特殊技名=n,this.描述=i,this.功能=c,this.功能数值=o,this.特效图=r}}class T{constructor(n,i){this.meta=n,this.basic=i}}function ee(){const t=new _("噬魂","","攻击",6,"噬魂.png"),n=new _("万剑决","","攻击",6,"万剑决.png"),i={姓名:"黄凌侯",职业:"仙修",画像:"character1.webp",特殊技1:t,特殊技2:null,特殊技3:null},c={血:100,功:4,防:1,法:10},o=new T(i,c),r={姓名:"文亮",职业:"剑修",画像:"character2.webp",特殊技1:n,特殊技2:null,特殊技3:null},s={血:105,功:2,防:3,法:5},p=new T(r,s);e.黄凌侯=o,e.文亮=p,e.p1Health=e.黄凌侯.basic.血,e.p2Health=e.文亮.basic.血,a.p1Name&&(a.p1Name.textContent=`P1 ${o.meta.姓名}`),a.p2Name&&(a.p2Name.textContent=`P2 ${p.meta.姓名}`)}const x=new(window.AudioContext||window.webkitAudioContext);let B=!1;function y(){B||(B=!0,x.state==="suspended"&&x.resume().catch(()=>{}))}async function te(t){y();const n=t==="p1"?F:G,i=new Audio(n);try{await i.play()}catch(c){console.error("Failed to play attack sound",c)}}async function ne(){y();const t=new Audio(K);try{await t.play()}catch(n){console.error("Failed to play block sound",n)}}async function ae(){y();const t=new Audio(q);try{await t.play()}catch(n){console.error("Failed to play dice sound",n)}}function oe(){ee(),a.btnLocal.addEventListener("click",()=>H("local")),a.btnOnline.addEventListener("click",()=>ce()),a.btnRoll.addEventListener("click",de),a.btnCopy.addEventListener("click",le);const n=new URLSearchParams(window.location.search).get("gameid");n&&ie(n)}function H(t){e.mode=t,g.menu.classList.remove("active"),g.game.classList.add("active"),z(),h()}function ce(){e.mode="online",e.role="host",a.inviteArea.classList.remove("hidden"),e.peer=new Peer,e.peer.on("open",t=>{const n=`${window.location.href}?gameid=${t}`;a.inviteLink.textContent=n}),e.peer.on("connection",t=>{e.conn=t,D(),H("online")})}function ie(t){e.mode="online",e.role="guest",g.menu.classList.remove("active"),g.game.classList.add("active"),e.peer=new Peer,e.peer.on("open",()=>{e.conn=e.peer.connect(t),D()})}function D(){e.conn.on("data",t=>{se(t)}),e.conn.on("open",()=>{console.log("Connected!"),f("Player 2 Connected!")})}function re(t){e.mode==="online"&&e.conn&&e.conn.send(t)}function se(t){t.type==="roll"?O(t.value):t.type==="restart"&&window.location.reload()}function le(){const t=a.inviteLink.textContent;!t||t==="Generating..."||navigator.clipboard.writeText(t).then(()=>{const n=a.btnCopy.textContent;a.btnCopy.textContent="Copied!",setTimeout(()=>{a.btnCopy.textContent=n},2e3)}).catch(n=>{console.error("Failed to copy text: ",n)})}function h(){const t=e.黄凌侯?e.黄凌侯.basic.血:100,n=e.文亮?e.文亮.basic.血:100,i=Math.max(0,e.p1Health/t*100),c=Math.max(0,e.p2Health/n*100);a.p1HealthBar.style.width=`${i}%`,a.p2HealthBar.style.width=`${c}%`,i<30&&a.p1HealthBar.classList.add("low"),c<30&&a.p2HealthBar.classList.add("low"),a.p1HealthText.textContent=`${e.p1Health}/${t}`,a.p2HealthText.textContent=`${e.p2Health}/${n}`,a.p1Card.classList.remove("active-turn","defending","defense-glow"),a.p2Card.classList.remove("active-turn","defending","defense-glow");let o=!1;if(e.gameOver){a.turnIndicator.textContent=e.p1Health<=0?"P2 Wins!":"P1 Wins!",a.btnRoll.disabled=!0;return}switch(e.turn){case"p1_attack":a.turnIndicator.textContent="P1 Attack",a.p1Card.classList.add("active-turn"),a.p2Card.classList.add("defending"),(e.mode==="local"||e.role==="host")&&(o=!0);break;case"p2_defend":a.turnIndicator.textContent="P2 Defend",a.p2Card.classList.add("active-turn","defense-glow"),(e.mode==="local"||e.role==="guest")&&(o=!0);break;case"p2_attack":a.turnIndicator.textContent="P2 Attack",a.p2Card.classList.add("active-turn"),a.p1Card.classList.add("defending"),(e.mode==="local"||e.role==="guest")&&(o=!0);break;case"p1_defend":a.turnIndicator.textContent="P1 Defend",a.p1Card.classList.add("active-turn","defense-glow"),(e.mode==="local"||e.role==="host")&&(o=!0);break}a.btnRoll.disabled=!o,a.btnRoll.style.opacity=o?"1":"0.5",a.btnRoll.style.cursor=o?"pointer":"not-allowed"}function de(){y(),ae(),a.btnRoll.disabled=!0;const t=1100,n=50,i=Date.now(),c=setInterval(()=>{const o=Math.floor(Math.random()*10)+1;if(a.diceValue.textContent=o,Date.now()-i>=t){clearInterval(c);const r=Math.floor(Math.random()*10)+1;re({type:"roll",value:r}),O(r)}},n)}function O(t,n){a.diceValue.textContent=t,f(`${pe()} rolled ${t}!`),e.turn==="p1_attack"?(e.p1Dice=t,setTimeout(()=>E(),1e3)):e.turn==="p2_defend"?(e.p2Dice=t,setTimeout(()=>{R("p1")},1e3)):e.turn==="p2_attack"?(e.p2Dice=t,setTimeout(()=>E(),1e3)):e.turn==="p1_defend"&&(e.p1Dice=t,setTimeout(()=>{R("p2")},1e3))}function pe(){return e.turn.startsWith("p1")?"Player 1":"Player 2"}function E(){e.turn==="p1_attack"?e.turn="p2_defend":e.turn==="p2_defend"?e.turn="p2_attack":e.turn==="p2_attack"?e.turn="p1_defend":e.turn==="p1_defend"&&(e.turn="p1_attack"),h()}function R(t){a.p1Card.classList.remove("active-turn","defending","defense-glow"),a.p2Card.classList.remove("active-turn","defending","defense-glow");const n=t==="p1",i=n?e.p1Dice:e.p2Dice,c=n?e.p2Dice:e.p1Dice,o=n?e.黄凌侯:e.文亮,r=n?e.文亮:e.黄凌侯,s=o.basic.功,p=r.basic.防,$=i+s,M=c+p,d=$-M,k=`(${i} + ${s}) - (${c} + ${p})`,u=n?"p2":"p1",C=n?"p1":"p2";if(d>0){const l=d;f(`Result: ${k} = ${l}. Damage: ${l}`),P(C,!1),setTimeout(()=>{S(u,l),v(`${u}-card`,l),w(n?"p2_attack":"p1_attack")},L)}else if(d>=-2)f(`Result: ${k} = ${d}. Blocked!`),ne(),Q(u),v(`${u}-card`,0),setTimeout(()=>w(n?"p2_attack":"p1_attack"),1e3);else{const l=Math.abs(d);f(`Result: ${k} = ${d}. COUNTER ATTACK! (-${l} HP)`),P(u,!0),setTimeout(()=>{S(C,l),v(`${C}-card`,l),w(n?"p2_attack":"p1_attack")},L)}}function P(t,n=!1){te(t),t==="p1"?(a.p1Card.classList.add("smash-animation-p1"),setTimeout(()=>{a.p2Card.classList.add("shake-animation"),n?A("p2"):I("p1")},400),setTimeout(()=>{a.p1Card.classList.remove("smash-animation-p1"),a.p2Card.classList.remove("shake-animation")},1e3)):(a.p2Card.classList.add("smash-animation-p2"),setTimeout(()=>{a.p1Card.classList.add("shake-animation"),n?A("p1"):I("p2")},400),setTimeout(()=>{a.p2Card.classList.remove("smash-animation-p2"),a.p1Card.classList.remove("shake-animation")},1e3))}function S(t,n){t==="p1"?e.p1Health=Math.max(0,e.p1Health-n):e.p2Health=Math.max(0,e.p2Health-n),h(),ue()}function w(t){e.gameOver||(e.turn=t,h())}function ue(){(e.p1Health<=0||e.p2Health<=0)&&(e.gameOver=!0,h())}function f(t){a.log.textContent=t,console.log(t)}oe();
