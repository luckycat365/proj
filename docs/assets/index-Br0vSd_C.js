(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))i(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const f of r.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function o(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(c){if(c.ep)return;c.ep=!0;const r=o(c);fetch(c.href,r)}})();const A=""+new URL("character1_basicattack-CoZWrIpI.png",import.meta.url).href,P=""+new URL("character2_basicattack-IToyPp5v.png",import.meta.url).href,D=""+new URL("block-C_NXB4xr.png",import.meta.url).href,H=""+new URL("character1_normalattack-CmNmJq-b.wav",import.meta.url).href,R=""+new URL("character2_normalattack-Ba-KFgnp.wav",import.meta.url).href,O=""+new URL("block-BpfqxD2X.wav",import.meta.url).href,l=100,y=1e3,e={mode:"local",role:"host",turn:"p1_attack",p1Health:l,p2Health:l,p1Dice:0,p2Dice:0,gameOver:!1,peer:null,conn:null},m={menu:document.getElementById("menu-screen"),game:document.getElementById("game-screen")},n={btnLocal:document.getElementById("btn-local"),btnOnline:document.getElementById("btn-online"),inviteArea:document.getElementById("invite-area"),inviteLink:document.getElementById("invite-link"),btnCopy:document.getElementById("btn-copy"),p1HealthBar:document.getElementById("p1-health"),p2HealthBar:document.getElementById("p2-health"),p1HealthText:document.getElementById("p1-hp-text"),p2HealthText:document.getElementById("p2-hp-text"),p1Card:document.getElementById("p1-card"),p2Card:document.getElementById("p2-card"),p1AttackOverlay:document.getElementById("p1-attack-overlay"),p2AttackOverlay:document.getElementById("p2-attack-overlay"),turnIndicator:document.getElementById("turn-indicator"),diceValue:document.getElementById("dice-value"),btnRoll:document.getElementById("btn-roll"),log:document.getElementById("game-log"),log:document.getElementById("game-log")},S=A,$=P,M=D;function _(t,a,o,i){t&&(t.src=a,t.classList.remove("show","show-block"),t.offsetWidth,t.classList.add(o),setTimeout(()=>{t.classList.remove(o)},i))}function p(t,a){const o=document.getElementById(t);if(!o)return;const i=document.createElement("div");i.classList.add("damage-number"),i.textContent=a,(a===0||a==="0")&&i.classList.add("blocked"),o.appendChild(i),setTimeout(()=>{i.remove()},2e3)}function g(t){const a=t==="p1"?n.p2AttackOverlay:n.p1AttackOverlay;a&&_(a,t==="p1"?S:$,"show",700)}function k(t){const a=t==="p1"?n.p1AttackOverlay:n.p2AttackOverlay;_(a,M,"show-block",560)}const C=new(window.AudioContext||window.webkitAudioContext);let v=!1;function h(){v||(v=!0,C.state==="suspended"&&C.resume().catch(()=>{}))}async function U(t){h();const a=t==="p1"?H:R,o=new Audio(a);try{await o.play()}catch(i){console.error("Failed to play attack sound",i)}}async function L(){h();const t=new Audio(O);try{await t.play()}catch(a){console.error("Failed to play block sound",a)}}function W(){n.btnLocal.addEventListener("click",()=>B("local")),n.btnOnline.addEventListener("click",()=>F()),n.btnRoll.addEventListener("click",X),n.btnCopy.addEventListener("click",q);const a=new URLSearchParams(window.location.search).get("gameid");a&&K(a)}function B(t){e.mode=t,m.menu.classList.remove("active"),m.game.classList.add("active"),d()}function F(){e.mode="online",e.role="host",n.inviteArea.classList.remove("hidden"),e.peer=new Peer,e.peer.on("open",t=>{const a=`${window.location.href}?gameid=${t}`;n.inviteLink.textContent=a}),e.peer.on("connection",t=>{e.conn=t,E(),B("online")})}function K(t){e.mode="online",e.role="guest",m.menu.classList.remove("active"),m.game.classList.add("active"),e.peer=new Peer,e.peer.on("open",()=>{e.conn=e.peer.connect(t),E()})}function E(){e.conn.on("data",t=>{G(t)}),e.conn.on("open",()=>{console.log("Connected!"),s("Player 2 Connected!")})}function N(t){e.mode==="online"&&e.conn&&e.conn.send(t)}function G(t){t.type==="roll"?T(t.value):t.type==="restart"&&window.location.reload()}function q(){const t=n.inviteLink.textContent;!t||t==="Generating..."||navigator.clipboard.writeText(t).then(()=>{const a=n.btnCopy.textContent;n.btnCopy.textContent="Copied!",setTimeout(()=>{n.btnCopy.textContent=a},2e3)}).catch(a=>{console.error("Failed to copy text: ",a)})}function d(){const t=Math.max(0,e.p1Health/l*100),a=Math.max(0,e.p2Health/l*100);n.p1HealthBar.style.width=`${t}%`,n.p2HealthBar.style.width=`${a}%`,t<30&&n.p1HealthBar.classList.add("low"),a<30&&n.p2HealthBar.classList.add("low"),n.p1HealthText.textContent=`${e.p1Health}/${l}`,n.p2HealthText.textContent=`${e.p2Health}/${l}`,n.p1Card.classList.remove("active-turn","defending"),n.p2Card.classList.remove("active-turn","defending");let o=!1;if(e.gameOver){n.turnIndicator.textContent=e.p1Health<=0?"Player 2 Wins!":"Player 1 Wins!",n.btnRoll.disabled=!0,n.btnRoll.textContent="Game Over";return}switch(e.turn){case"p1_attack":n.turnIndicator.textContent="Player 1 Attack Phase",n.p1Card.classList.add("active-turn"),n.p2Card.classList.add("defending"),(e.mode==="local"||e.role==="host")&&(o=!0);break;case"p2_defend":n.turnIndicator.textContent="Player 2 Defend Phase",n.p2Card.classList.add("active-turn"),(e.mode==="local"||e.role==="guest")&&(o=!0);break;case"p2_attack":n.turnIndicator.textContent="Player 2 Attack Phase",n.p2Card.classList.add("active-turn"),n.p1Card.classList.add("defending"),(e.mode==="local"||e.role==="guest")&&(o=!0);break;case"p1_defend":n.turnIndicator.textContent="Player 1 Defend Phase",n.p1Card.classList.add("active-turn"),(e.mode==="local"||e.role==="host")&&(o=!0);break}n.btnRoll.disabled=!o,!o&&e.mode==="online"?n.btnRoll.textContent="Waiting for Opponent...":n.btnRoll.textContent="Roll Dice (1-10)",e.mode==="local"&&(n.btnRoll.textContent="Roll Dice")}function X(){h();const t=Math.floor(Math.random()*10)+1;N({type:"roll",value:t}),T(t)}function T(t,a){n.diceValue.textContent=t,s(`${V()} rolled ${t}!`),e.turn==="p1_attack"?(e.p1Dice=t,setTimeout(()=>b(),1e3)):e.turn==="p2_defend"?(e.p2Dice=t,setTimeout(()=>{w("p1")},1e3)):e.turn==="p2_attack"?(e.p2Dice=t,setTimeout(()=>b(),1e3)):e.turn==="p1_defend"&&(e.p1Dice=t,setTimeout(()=>{w("p2")},1e3))}function V(){return e.turn.startsWith("p1")?"Player 1":"Player 2"}function b(){e.turn==="p1_attack"?e.turn="p2_defend":e.turn==="p2_defend"?e.turn="p2_attack":e.turn==="p2_attack"?e.turn="p1_defend":e.turn==="p1_defend"&&(e.turn="p1_attack"),d()}function w(t){let a=0;t==="p1"?(a=Math.max(0,e.p1Dice-e.p2Dice),s(`Result: ${e.p1Dice} (ATK) vs ${e.p2Dice} (DEF). Damage: ${a}`),a>0?(x("p1"),setTimeout(()=>{I("p2",a),p("p2-card",a),u("p2_attack")},y)):(s("Blocked!"),L(),k("p2"),p("p2-card",0),setTimeout(()=>u("p2_attack"),1e3))):(a=Math.max(0,e.p2Dice-e.p1Dice),s(`Result: ${e.p2Dice} (ATK) vs ${e.p1Dice} (DEF). Damage: ${a}`),a>0?(x("p2"),setTimeout(()=>{I("p1",a),p("p1-card",a),u("p1_attack")},y)):(s("Blocked!"),L(),k("p1"),p("p1-card",0),setTimeout(()=>u("p1_attack"),1e3)))}function x(t){U(t),t==="p1"?(n.p1Card.classList.add("smash-animation-p1"),setTimeout(()=>{n.p2Card.classList.add("shake-animation"),g("p1")},400),setTimeout(()=>{n.p1Card.classList.remove("smash-animation-p1"),n.p2Card.classList.remove("shake-animation")},1e3)):(n.p2Card.classList.add("smash-animation-p2"),setTimeout(()=>{n.p1Card.classList.add("shake-animation"),g("p2")},400),setTimeout(()=>{n.p2Card.classList.remove("smash-animation-p2"),n.p1Card.classList.remove("shake-animation")},1e3))}function I(t,a){t==="p1"?e.p1Health=Math.max(0,e.p1Health-a):e.p2Health=Math.max(0,e.p2Health-a),d(),j()}function u(t){e.gameOver||(e.turn=t,d())}function j(){(e.p1Health<=0||e.p2Health<=0)&&(e.gameOver=!0,d())}function s(t){n.log.textContent=t,console.log(t)}W();
